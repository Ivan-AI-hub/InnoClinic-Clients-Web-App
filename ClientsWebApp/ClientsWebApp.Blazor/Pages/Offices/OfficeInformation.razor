@page "/offices/{officeId:guid}"
@inherits CancellableComponent
@attribute [Authorize(Roles = "Admin")]

@inject IOfficeManager officeManager
@inject NavigationManager navigationManager

<div class="row mb-3 align-items-center">
    @if (Office != null)
    {
        @if (@Office.Photo != null)
        {
            <div class="col">
                <ImageFromByteArray Image="@Office.Photo.Content" imgClass="img-thumbnail rounded float-right" width="100" height="100" />
            </div>
        }
        <div class="col">
            <div>@Office.Address</div>
            <div>@Office.OfficeNumber</div>
            <div>@Office.PhoneNumber</div>
            <EditForm Model="@Office" class="form">
                <InputCheckbox @bind-Value="@Office.Status" @oninput="@CheckBoxChanged" />
            </EditForm>
        </div>
        <div class="col">
            <button class="btn btn-info" @onclick="NavigateToEditPage">Изменить</button>
        </div>

    }
</div>


@code {
    [Parameter] public Guid OfficeId { get; set; }
    private OfficeDTO Office;
    protected async override Task OnInitializedAsync()
    {
        Office = await officeManager.GetByIdAsync(OfficeId, _cts.Token);
    }

    private async void CheckBoxChanged(ChangeEventArgs args)
    {
        var value = bool.Parse(args.Value.ToString());
        Office.Status = value;
        await officeManager.UpdateStatusAsync(OfficeId, value, _cts.Token);
    }

    private void NavigateToEditPage()
    {
        navigationManager.NavigateTo($"/offices/{OfficeId}/edit");
    }
}